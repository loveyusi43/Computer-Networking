# Computer Networking

​                                                       A Top-Down Approach

## 计算机网络和因特网

### 什么是因特网

#### 具体构成描述

- 因特网是一个世界范围内的计算机网络，即它是一个互联了遍及全世界数十亿的计算设备的网络。
- 所有与因特网相连的设备都称为**主机**(host)或**端系统**(end system)。
- 端系统通过**通信链路**(communication link)和**分组交换机**(packet switch)连接到一起。
- 不同的链路能够以不同的速率传输数据，链路的**传输速率**(transmission rate)以比特/秒(bit/s, 或bps)度量。当一台端系统要向另一台端系统发送数据时，发送端系统将数据分段，并为每段加上首部字节。由此形成的信息包用计算机网络的术语来说称为**分组**(packet)。这些分组通过网络发送到目的端系统，在那里被装配成初始数据。
- 在当今的因特网中，两种最著名的分组交换机类型是**路由器**(router)和**链路层交换机**(link-layer switch)。这两种类型的交换机朝着最终目的地转发分组。链路层交换机通常用于接入网中，而路由器通常用于网络核心中。从发送端系统到接收端系统，一个分组所经历的一系列通信链路和分组交换机称为通过该网络的**路径**(route或path)。
- 端系统通过**因特网服务提供商**(Internet Service Provider, ISP)接入因特网，每个ISP自身就是一个由多台分组交换机和多段通信链路组成的网络。
- 端系统、分组交换机和其它因特网部件都要运行一系列**协议**(protocol)，这些协议控制因特网中信息的发送和接收。**TCP**(Transmission Control Protocol, 传输控制协议)和**IP**(Internet Protocol, 网际协议)是因特网中两个最重要的协议。IP协议定义在路由器和端系统之间发送和接收的分组格式。因特网的主要协议统称为**TCP/IP**。

#### 服务描述

从为应用程序提供服务的基础设施的角度来描述因特网。

- 与因特网相连的端系统提供了一个**套接字接口**(socket interface)，该接口运行在一个端系统上的应用程序请求因特网基础设施向运行在另一端系统上的特定目的地程序交付数据的方式。

#### 什么是协议

1. 人类活动的类比

   ![<img src="Computer Networking.assets/image-20221203151621619.png" alt="image-20221203151621619" style="zoom:67%;" />]

2. 网络协议

**协议**(protocol)定义了在两个或多个通信实体之间交换的报文的格式和顺序，以及报文发送、接收一条报文或其它事件采取的行动。

---

#### 复习题

1. “主机”和“端系统”之间有什么不同吗？列举几种不同的端系统。Web服务器是一种端系统吗？

- “主机”==“端系统”
- 传统：桌面PC、Linux工作站以及所谓的服务器;非传统：家用电器、汽车、游戏机等等能上网的设备
- 是的

2. “协议”常被用于外交关系。维基百科是怎么描述外交协议的？

[外交协议](https://zh.m.wikipedia.org/zh-hans/%E5%A4%96%E4%BA%A4)

3. 标准对于协议为什么这么重要？

标准定义了做什么，协议负责怎么做

### 网络边缘

端系统也称为主机(host)，主机=端系统。主机有时又被进一步划分为两类：**客户**(client)和**服务器**(server)。

#### 接入网

**接入网**是指将端系统物理连接到其**边缘路由器**(edge router)的网络。边缘路由器是端系统到任何其它远端系统的路径上的第一台路由器。

1. 家庭接入：DSL、电缆、FTTH、拨号和卫星

- 宽带住宅接入有两种最流行的方式：**数字用户线**(Digital Subscriber Line, DSL)和电缆。
- 当使用DSL时。用户的本地电话公司也是他的ISP。每个用户的DSL调制解调器使用现有的电话线(即双绞铜线)与电话公司的本地中心局(CO)中的数字用户线接入复用器(DSLAM)交换数据。

<img src="Computer Networking.assets/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAWFUgSG9uZ2R1bw==,size_20,color_FFFFFF,t_70,g_se,x_16.png" alt="img" style="zoom: 67%;" />

- DSL利用电话公司现有的本地电话基础设施，而**电缆因特网接入**(cable Internet access)利用了有线电视公司现有的有线电视基础设施。电缆因特网接入需要特殊的调制解调器，这种调制解调器称为电缆调制解调器(cable modem)
- **光纤到户**(Fiber To The Home)

2. 企业(和家庭)接入：以太网和WiFi
3. 广域无线接入：3G和LTE

#### 物理媒体

物理媒体的例子包括双绞铜线、同轴电缆、多模光纤维、陆地无线电频谱、和卫星无线电频谱。物理媒体分成两种类型：**引导型媒体**(guided media)和**非引导型媒体**(unguided media)

1. 双绞铜线
2. 同轴电缆
3. 光纤
4. 陆地无线电信道
5. 卫星无线电信道

### 网络核心

#### 分组交换

在各种网络应用中，端系统彼此交换**报文**(message)。报文能够包含协议涉及所需要的任何东西。报文可以执行一种控制功能，也可以包含数据。为了从源端系统向目的端系统发送一个报文，源将长报文划分成=为较小的数据块，称之为**分组**(packet)。在源和目的之间，每个分组都要通过链路和**分组交换机**(packet switch)传送。

1. 存储转发传输

多数分组交换机在链路的输入端使用**存储转发传输**(store-and-forward transmission)机制。存储转发传输是指在交换机能够开始向输出链路传输该分组的第一个比特之前，必须接受到接收到整个分组。

2. 排队时延和分组丢失

每台分组交换机有多个链路与之向连。对于每条相连的链路，该分组交换机具有一个**输出缓存**(output buffer，也称为**输出队列**(output queue))，它用于存储路由器准备发往那条链路的分组。

3. 转发表和路由选择协议

在因特网中，每端系统具有一个称为IP地址的地址。当源主机要向目的端系统发送一个分组时，源在该分组的首部包含了目的地的IP地址。

#### 电路交换

1. 电路交换网络中的复用
   - **频分复用**
   - **时分复用**
2. 分组交换与电路交换的对比

#### 网络的网络

- 网络结构1：用单一的全球传输ISP互联所有接入ISP。(假设全球只有一个ISP)，(接入ISP=**客户**(customer))
- 网络结构2：如果某个公司建立并运营一个可赢利的全球传输ISP，其它公司建立自己的全球传输ISP并与最初的全球传输ISP竞争则是一件自然的事。这导致了网络结构2，它由数十万接入ISP和多个全球传输ISP组成
- 网络结构3：在任何给定的区域，可能有一个**区域ISP**(regional ISP)，每个区域ISP则与**第一层ISP**(tier-1 ISP)连接。
- 网络结构4：**由接入ISP**、**区域ISP**、**第一层ISP**、**PoP**(Point of Presence)、**多宿**(multi-home)、**对等**(peer)和**IXP**(Internet Exchange Point)
- 网络结构5：它通过在网络结构4顶部增加**内容提供商网络**(content provider network)

<img src="Computer Networking.assets/669116-20170411231535266-1031494743.jpg" alt="img" style="zoom:67%;" />

### 分组交换网中的时延、丢包和吞吐量

#### 分组交换网中的时延概述

- 时延的类型
  - 处理时延：检查分组首部和决定将该分组导向何处所需要的时间是处理时延的一部分。处理时延也能够包括其它因素。如检查比特级别的差错所需要的时间。
  - 排队时延：在队列中，当分组在链路上等待传输时，它经受排队时延。
  - 传输时延：用L比特表示该分组(即将传输的分组)的长度，用R bps(即b/s)表示从路由器A到路由器B的链路传输速率。例如，对于一条xMbps的以太网链路，速率R=xMbps。传输时延=L/R。
  - 传播时延：一旦一个比特被推向链路，该比特需要向路由器B传播。从该链路的起点到路由器B传播所需要的时间是传播时延。该比特以该链路的传播速率传播。该传播速率取决于该链路的物理媒体(即光纤、双绞铜线等)，其速率范围是$2\times10^8-3\times10^8m/s$，这等于或略小于光速。传播时延是d/s，其中d是路由器A和路由器B之间的距离，s是该链路的传播速率。
- 传输时延和传播时延的比较

传输时延是路由器退出分组所需要的时间，它是分组长度和链路传播速率的函数，而与两台路由器之间的距离无关。另一方面，传播时延是一个比特从一台路由器到另一台路由器所需要的时间，它是两台路由器之间距离的函数，而与分组长度或链路传输速率无关。(时间=路程/速度)

#### 排队时延和丢包

节点时延的最复杂和有趣的成分是排队时延$d_{queue}$。于其它3项时延(即$d_{proc}、$$d_{trans}$和$d_{prop}$)不同的是，排队时延对不同的分组可能是不同的。例如。如果10个分组同时到达空队列，传输的第一个分组没有排队时延，而传输的最后一个分组将经受相对较大的排队时延(这时它要等待其它9个分组被传输)。

令a表示分组到达队列的平均速率(a的单位是分组/秒，即pkt/s)。R是传播速率，即从队列中推出比特的速率(bps/s即/b/s为单位)。为了简单起见，也假定所有分组都是由L个比特组成的。则比特到达队列的平均速率$La\ bps$。最后，假定该队列非常大，因此它基本能容纳无线数量的比特。比率$La/R$被称为是**流量强度**(traffic intensity)，它在估计排队时延的范围方面经常起着重要的作用。如果$La/ R>1$，则比特到达队列的平均速率超过该队列传输出去的速率。在这种不幸的情况下，该队列趋于无限增加，并且排队时延将趋向无限大！因此，流量工程中的一条金科玉律是：**设计系统是流量强度不能大于1**。

**丢包**(drop)

因为排队容量是有限的，随着流量强度接近1，排队时延并不真正趋向无穷大。相反，到达的分组将发现一个慢的队列。由于没有地方存储这个分组，路由器将丢弃该分组，即该分组将会丢失(lost)。

#### 端到端时延

假定在源主机和目的主机之间有N-1台路由器。我们还要假设该网络此时是无拥塞的(因此排队时延是微不足道的)，在每台路由器和源主机上的处理时延是$d_{proc}$，每台路由器和源主机的输出速率是R bps，每条链路的传播时延是$d_{pro p}$。节点累加起来，得到端到端时延：
$$
d_{end-end}=N(d_{proc}+d_{trans}+d_{prop})
$$
式中$d_{tran s}=L/R$，其中L是分组长度。

#### 计算机网络中的吞吐量

为了定义吞吐量，考虑从主机A到主机B跨越计算机网络传送一个大文件。在任何时间**瞬间吞吐量**是主机B接收到该文件的速率(以bps计)。如果该文件有F比特组成，主机B接收所有F比特用去了T秒，则文件传送的**平均吞吐量**是F/T bps。·

假设服务器和客户之间有有两条通信链路和一个路由器。令$R_s$表示服务器于路由器之间的链路速率；$R_c$表示路由器与客户之间的链路速率。对于这种简单的两链路网络，其吞吐量是$min\{R_c, R_s\}$，这就是说，它是**瓶颈链路的传输速率**。

### 协议层次及其服务模型

#### 分层的体系结构

- 位于应用层的信息分组称为**报文**(message)。
- 运输层的分组称为**报文段**(segment)
- 网络层的分组称为**数据报**(datagram)
- 链路层的分组称为**帧**(frame)
- 物理层的任务是将帧中的一个个比特从一个节点移动到下一个节点。

#### 封装

<img src="Computer Networking.assets/分层模型.jpg" alt="分层模型" style="zoom: 10%;" />

### 面对攻击的网络

- **病毒**是一种需要某种形式的用户交互来感染用户设备的的恶意软件。
- **蠕虫**是一种无须任何明显用户交互就能进入设备的恶意软件
- **拒绝服务攻击**(Denial-of-Service(DoS)attack)
  - 弱点攻击
  - 带宽洪范
  - 连接洪范

### 计算机网络和因特网的历史

#### 分组交换的发展：1961~1972

#### 专用网络和网络互联：1972~1980

#### 网络的激增：1980~1990

#### 因特网爆炸：20世纪90年代

#### 最新发展

## 应用层

### 应用层协议原理

#### 网络应用程序体系结构

P2P体系结构的最引人入胜的特性之一是它们的**自拓展性**。然而，未来P2P应用由于高度非集中式结构，面临安全性、性能和可靠性等挑战。

#### 进程通信

用操作系统的术语来说，进行通信的实际上是**进程**(process)而不是程序。两个不同端系统上的进程，通过跨越计算机网络交换**报文**(message)而相互通信。

1. **客户和服务器进程**

对于Web而言，浏览器是一个客户进程，Web服务器是一台服务器进程。对于P2P文件共享，下载文件的对等方标识为客户，上载文件的对等方标识为服务器。

定义客户和服务器如下：
在一对进程之间的通信会话场景中，发起通信(即在该会话开始时发起与其它进程的联系)的进程被标识为**客户**，在会话开始是等待联系的进程是**服务器**

2. **进程与计算机之间的接口**

3. **进程寻址**

#### 可供应应用程序使用的运输服务

大体能够从四个方面对应用程序服务要求进行分类：可靠数据传输、吞吐量、定时和安全性

1. **可靠数据传输**

可能导致数据丢失的情况：分组能够使路由器中的缓存溢出，或者当分组中的某些比特损坏后可能被丢弃。

2. **吞吐量**

具有吞吐量要求的应用程序被称为**带宽敏感应用**，如大多数多媒体应用。

3. **定时**
4. **安全性**

#### 因特网提供的运输服务

1. **TCP服务**

   - 面向连接的服务：所谓的握手过程提醒客户和服务器，让它们为大量分组的到来做好准备。在握手阶段后，一个TCP就在两个进程的套接字之间建立了。当应用程序技术发送报文时，必须拆除该连接。
   - 可靠的数据传送服务：通信进程能够依靠TCP，无差错的、按适当的顺序交付所有发送的数据。

   TCP服务还具有拥塞控制机制，这种服务不一定能为通信进程带来好处，但能为因特网带来整体好处。

2. **UDP服务**

UDP是一种不提供不必要服务的轻量级运输协议，它仅提供最小服务。

3. **因特网运输协议所不提供的服务**

今天的因特网能够为时间敏感应用提供满意的服务，但它不能提供任何定时或带宽保证。

#### 应用层协议

应用层协议定义了：

- 交换的报文类型，例如请求报文和响应报文。
- 各种报文类型的语法，如报文中各个字段及这些字段是如何描述的。
- 字段的含义，即这些字段中的信息的含义。
- 确定一个进程合时以及如何发送报文，对报文进行响应的规则。

Web是一种客户-服务器应用，它允许客户按照需求从Web服务器获得文档。该Web应用有许多组成部分，包括文档格式的标准(即HTML)、Web浏览器、Web服务器，以及一个应用层协议。Web的应用层协议是HTTP，HTTP只是Web应用的一部分(尽管是重要部分)。

#### 本书涉及的网络应用

Web、文件传输、电子邮件、目录服务、流式视频和P2P。

### Web和HTTP

